FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGtleWNsb2FrLWFwYgpkZXNjcmlwdGlvbjogS2V5Y2xvYWsgLSBP\
cGVuIFNvdXJjZSBJZGVudGl0eSBhbmQgQWNjZXNzIE1hbmFnZW1lbnQKYmluZGFibGU6IFRydWUK\
YXN5bmM6IHJlcXVpcmVkCnRhZ3M6IAogIC0gbW9iaWxlLXNlcnZpY2UKICAtIG1vYmlsZS1jbGll\
bnQtZW5hYmxlZAptZXRhZGF0YToKICBkaXNwbGF5TmFtZTogMS5LZXljbG9hawogIGltYWdlVXJs\
OiAiaHR0cHM6Ly9wYnMudHdpbWcuY29tL3Byb2ZpbGVfaW1hZ2VzLzcwMjExOTgyMTk3OTM0NDg5\
Ny9vQUMwNWNFQl80MDB4NDAwLnBuZyIKICBkb2N1bWVudGF0aW9uVXJsOiAiaHR0cDovL3d3dy5r\
ZXljbG9hay5vcmcvZG9jdW1lbnRhdGlvbi5odG1sIgogIHByb3ZpZGVyRGlzcGxheU5hbWU6ICJS\
ZWQgSGF0LCBJbmMuIgogIGRlcGVuZGVuY2llczoKICAgIC0gImRvY2tlci5pby9qYm9zcy9rZXlj\
bG9hay1vcGVuc2hpZnQ6My40LjMuRmluYWwiCiAgICAtICJkb2NrZXIuaW8vY2VudG9zL3Bvc3Rn\
cmVzcWwtOTYtY2VudG9zNzo5LjYiCiAgc2RrLWRvY3MtYW5kcm9pZDogImh0dHBzOi8vZG9jcy5h\
ZXJvZ2Vhci5vcmcvYW5kcm9pZC1zZGsvbGF0ZXN0L2dldHRpbmctc3RhcnRlZC9hdXRoLmh0bWwi\
CiAgc2RrLWRvY3MtY29yZG92YTogImh0dHBzOi8vZ2l0aHViLmNvbS9hZXJvZ2Vhci9hZXJvZ2Vh\
ci1hbmRyb2lkLXNkay9ibG9iL21hc3Rlci9kb2NzL21vZHVsZXMvUk9PVC9wYWdlcy9hdXRoLmFk\
b2MiCiAgc2RrLWRvY3MtaW9zOiAiaHR0cHM6Ly9naXRodWIuY29tL2Flcm9nZWFyL2Flcm9nZWFy\
LWFuZHJvaWQtc2RrL2Jsb2IvbWFzdGVyL2RvY3MvbW9kdWxlcy9ST09UL3BhZ2VzL2F1dGguYWRv\
YyIKICBzZGstZG9jcy14YW1hcmluOiAiaHR0cHM6Ly9naXRodWIuY29tL2Flcm9nZWFyL2Flcm9n\
ZWFyLWFuZHJvaWQtc2RrL2Jsb2IvbWFzdGVyL2RvY3MvbW9kdWxlcy9ST09UL3BhZ2VzL2F1dGgu\
YWRvYyIKICBzZXJ2aWNlTmFtZToga2V5Y2xvYWsKcGxhbnM6CiAgLSBuYW1lOiBkZWZhdWx0CiAg\
ICBkZXNjcmlwdGlvbjogRGVwbG95IGtleWNsb2FrCiAgICBmcmVlOiBUcnVlCiAgICBtZXRhZGF0\
YToKICAgICAgbW9iaWxlY2xpZW50X2JpbmRfcGFyYW1ldGVyc19kYXRhOgogICAgICAgIC0gJ3si\
bmFtZSI6ICJDTElFTlRfSUQiLCAidmFsdWUiOiAibWV0YWRhdGEubmFtZSIsICJ0eXBlIjogInBh\
dGgifScKICAgICAgICAtICd7Im5hbWUiOiAiQ0xJRU5UX1RZUEUiLCAidmFsdWUiOiAicHVibGlj\
IiwgInR5cGUiOiAiZGVmYXVsdCJ9JwogICAgICBzZXJ2aWNlaW5zdGFuY2VfYmluZF9wYXJhbWV0\
ZXJzX2RhdGE6CiAgICAgICAgLSAneyJuYW1lIjogIkNMSUVOVF9JRCIsICJ2YWx1ZSI6ICJtZXRh\
ZGF0YS5uYW1lIiwgInR5cGUiOiAicGF0aCJ9JwogICAgICAgIC0gJ3sibmFtZSI6ICJDTElFTlRf\
VFlQRSIsICJ2YWx1ZSI6ICJiZWFyZXIiLCAidHlwZSI6ICJkZWZhdWx0In0nCiAgICBwYXJhbWV0\
ZXJzOiAKICAgIC0gbmFtZTogQURNSU5fVVNFUk5BTUUKICAgICAgcmVxdWlyZWQ6IFRydWUKICAg\
ICAgZGVmYXVsdDogYWRtaW4KICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBLZXljbG9h\
ayBhZG1pbiB1c2VybmFtZQogICAgLSBuYW1lOiBBRE1JTl9QQVNTV09SRAogICAgICByZXF1aXJl\
ZDogVHJ1ZQogICAgICBkZWZhdWx0OiBhZG1pbgogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0\
bGU6IEtleWNsb2FrIGFkbWluIHBhc3N3b3JkCiAgICAtIG5hbWU6IENVU1RPTV9SRUFMTV9OQU1F\
CiAgICAgIHJlcXVpcmVkOiBGYWxzZQogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IE5h\
bWUgb2YgdGhlIEtleWNsb2FrIHJlYWxtIChkZWZhdWx0cyB0byBjdXJyZW50IG5hbWVzcGFjZSkK\
ICAgIC0gbmFtZTogVVNFX1NIQVJFRF9TRVJWSUNFCiAgICAgIHJlcXVpcmVkOiBGYWxzZQogICAg\
ICB0eXBlOiBib29sCiAgICAgIHRpdGxlOiBDb25uZWN0IHRvIGFuIGV4aXN0aW5nIHNoYXJlZCBz\
ZXJ2aWNlCiAgICAtIG5hbWU6IFNIQVJFRF9IT1NUCiAgICAgIHJlcXVpcmVkOiBGYWxzZQogICAg\
ICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IFVSTCBvZiB0aGUgc2hhcmVkIHNlcnZpY2UKICAg\
IGJpbmRfcGFyYW1ldGVyczoKICAgIC0gbmFtZTogQ0xJRU5UX0lECiAgICAgIHJlcXVpcmVkOiBU\
cnVlCiAgICAgIHRpdGxlOiBNb2JpbGUgY2xpZW50IElEL1NlcnZpY2UgSUQKICAgICAgdHlwZTog\
c3RyaW5nCiAgICAtIG5hbWU6IENMSUVOVF9UWVBFCiAgICAgIHJlcXVpcmVkOiBUcnVlCiAgICAg\
IHRpdGxlOiBLZXljbG9hayBjbGllbnQgdHlwZQogICAgICB0eXBlOiBlbnVtCiAgICAgIGVudW06\
IFsnYmVhcmVyJywgJ3B1YmxpYyddCiAgICAgIGRlZmF1bHQ6IHB1YmxpYwo="






COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY vars /opt/ansible/vars
RUN yum install epel-release -y && yum install jq -y
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -p /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb